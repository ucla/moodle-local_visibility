{"version":3,"sources":["../src/visibility.js"],"names":["define","$","notification","str","element","confirmationDialog","confirmationText","action","get_strings","key","component","done","strs","confirm","bind","fail","exception","deleteSession","id","data","courseId","ajax","url","courseid","rangeid","sesskey","M","cfg","msg","success","fadeOut","remove","alert","successmsg","count","location","reload","moodleStringPromise","get_string","when","errorMsg","window","deleteAllSessions","init","click","ev","preventDefault"],"mappings":"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","sourcesContent":["define(['jquery', 'core/notification', 'core/str'], function($, notification, str) {\n    // Private variables and functions.\n\n    /** @var {Number} element The current clicked element */\n    var element = 0;\n\n    /**\n     * Displays a confirmation dialog box for deleting visibility session.\n     *\n     * @param {String} confirmationText The string that should be used for the confirmation dialogue.\n     * @param {Function} action         The callback that performs the ajax action upon confirmation.\n     * @method confirmationDialog\n     */\n    var confirmationDialog = function(confirmationText, action) {\n        // Create confirmation string dialog\n        str.get_strings([\n            { key: 'confirm', component: 'moodle' },\n            { key: confirmationText, component: 'local_visibility' },\n            { key: 'yes', component: 'core' },\n            { key: 'no', component: 'core' }\n        ]).done(function(strs) {\n            notification.confirm(\n                strs[0], // Confirm\n                strs[1], // Are you absolutely sure?\n                strs[2], // Yes\n                strs[3], // No\n                action // On Confirm\n            );\n        }.bind(this)).fail(notification.exception);\n    };\n\n    /**\n     * Deletes selected visibility session via ajax\n     *\n     * @method deleteSession\n     */\n    var deleteSession = function(){\n        var id = element.data('id');\n        var courseId = element.data('course');\n\n        $.ajax({\n            url: \"ajax.php\",\n            data: {\n                action: 'delete',\n                courseid: courseId,\n                rangeid: id,\n                sesskey: M.cfg.sesskey\n            }\n        }).done(function( msg ) {\n            if (msg.success) {\n                $(\".range\" + id).fadeOut(250);\n                $(\".notifications\").remove();   // Remove any notices if any.\n                notification.alert(\n                    null,\n                    msg.successmsg\n                );\n                if (msg.count == 0) {\n                    location.reload(); // Reload the page so Visibility dropdown is unlocked.\n                }\n            } else {\n                // Deletion failed. Display an error message.\n                var moodleStringPromise = str.get_string('deleteerror', 'local_visibility');\n                $.when(moodleStringPromise).done(function(errorMsg) {\n                    window.alert(errorMsg);\n                });\n            }\n        });\n    };\n\n    /**\n     * Deletes all visibility sessions via ajax\n     *\n     * @method deleteAllSessions\n     */\n    var deleteAllSessions = function(){\n        var courseId = element.data('course');\n\n        $.ajax({\n            url: \"ajax.php\",\n            data: {\n                action: 'deleteall',\n                courseid: courseId,\n                sesskey: M.cfg.sesskey\n            }\n        }).done(function( msg ) {\n            if (msg.success) {\n                $(\".visibility-session\").fadeOut(250);\n                $(\".notifications\").remove();   // Remove any notices if any.\n                notification.alert(\n                    null,\n                    msg.successmsg\n                );\n                location.reload(); // Reload the page so Visibility dropdown is unlocked.\n            } else {\n                // Deletion failed. Display an error message.\n                var moodleStringPromise = str.get_string('deleteallerror', 'local_visibility');\n                $.when(moodleStringPromise).done(function(errorMsg) {\n                    window.alert(errorMsg);\n                });\n            }\n        });\n    };\n\n    return {\n        // Public variables and functions\n\n        /**\n         * Initialise the module.\n         * @method init\n         */\n        init: function() {\n            $('.rangedeletebutton').click(function(ev) {\n                element = $(this);\n                ev.preventDefault();\n                confirmationDialog('confirmremovevisibilitysession', deleteSession);\n            });\n            $('#id_rangedeleteallbutton').click(function(ev) {\n                element = $(this);\n                ev.preventDefault();\n                confirmationDialog('confirmdeleteallsessions', deleteAllSessions);\n            });\n        }\n    };\n});"],"file":"visibility.min.js"}